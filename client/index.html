<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatforia</title>

    <!-- Apply saved theme before first paint to avoid a flash -->
    <script>
      (function () {
        try {
          const KEY = 'chatforia:themeMode'; // e.g. 'dawn', 'midnight', etc.
          const saved = localStorage.getItem(KEY) || 'dawn';
          document.documentElement.setAttribute('data-theme', saved);
        } catch {
          document.documentElement.setAttribute('data-theme', 'dawn');
        }
      })();
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&family=Syne:wght@700;800&display=swap" rel="stylesheet">

    <!-- Favicons (light/dark) + Safari pinned tab -->
    <link id="favicon-light" rel="icon" type="image/svg+xml" href="/favicons/favicon-light.svg" media="(prefers-color-scheme: light)">
    <link id="favicon-dark"  rel="icon" type="image/svg+xml" href="/favicons/favicon-dark.svg"  media="(prefers-color-scheme: dark)">
    <link id="mask-icon" rel="mask-icon" href="/favicons/pinned-tab.svg" color="#111111">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Keep favicon + theme-color in sync with app theme -->
    <script>
      (function () {
        // Map your named themes -> light/dark boolean
        const isLightTheme = (name) => {
          const n = String(name || '').toLowerCase();
          return ['dawn', 'light', 'sunset', 'velvet', 'aurora', 'solarized'].includes(n);
        };

        function applyFaviconForTheme(themeName) {
          const light = isLightTheme(themeName);
          const lightLink = document.getElementById('favicon-light');
          const darkLink  = document.getElementById('favicon-dark');
          const themeMeta = document.querySelector('meta[name="theme-color"]');
          const maskIcon  = document.getElementById('mask-icon');

          if (lightLink && darkLink) {
            // Ensure only one is active at a time
            lightLink.media = light ? 'all' : 'not all';
            darkLink.media  = light ? 'not all' : 'all';
          }
          if (themeMeta) themeMeta.setAttribute('content', light ? '#ffffff' : '#0b0b0b');
          if (maskIcon)  maskIcon.setAttribute('color', light ? '#111111' : '#f5f5f5');
        }

        const current = () => document.documentElement.getAttribute('data-theme') || 'dawn';
        applyFaviconForTheme(current());

        // React to app-driven theme changes: <html data-theme="...">
        new MutationObserver(() => applyFaviconForTheme(current()))
          .observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

        // Also react when system dark-mode flips (in case your theme follows system)
        const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
        if (mq && mq.addEventListener) mq.addEventListener('change', () => applyFaviconForTheme(current()));
      })();
    </script>
  </body>
</html>
