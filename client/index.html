<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatforia</title>

    <!-- Early theme boot: apply theme before paint to avoid FOUC -->
    <script>
      (function() {
        try {
          const KEY = 'chatforia:themeMode'; // stored by themeManager (palette key)
          // We store actual palette keys (e.g. 'dawn', 'midnight'); decide light/dark by helper later.
          const saved = localStorage.getItem(KEY);
          const fallback = 'dawn';
          const mode = saved || fallback;
          document.documentElement.setAttribute('data-theme', mode);
        } catch (_) {
          document.documentElement.setAttribute('data-theme', 'dawn');
        }
      })();
    </script>

    <!-- Fonts (Inter for UI, Syne for the big “C”) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&family=Syne:wght@700;800&display=swap" rel="stylesheet">

    <!-- Safari pinned tabs (accent color is the warm amber) -->
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#FFB300">

    <!-- Theme-aware favicon (updated dynamically below) -->
    <link id="cf-favicon" rel="icon" href="/brand/favicon-dawn.svg" />

    <!-- Optional: fallback theme color for some UAs -->
    <meta name="theme-color" content="#FFF7F0" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Theme-aware favicon swapper (keeps in sync with <html data-theme="...">) -->
    <script>
      (function () {
        const link = document.getElementById('cf-favicon');
        if (!link) return;

        const ICON_BY_THEME = {
          dawn: '/brand/favicon-dawn.svg',
          light: '/brand/favicon-dawn.svg',
          dark: '/brand/favicon-midnight.svg',
          midnight: '/brand/favicon-midnight.svg',
          neon: '/brand/favicon-neon.svg',
          amoled: '/brand/favicon-neon.svg',
          sunset: '/brand/favicon-sunset.svg',
          aurora: '/brand/favicon-aurora.svg',
          solarized: '/brand/favicon-solarized.svg',
          velvet: '/brand/favicon-velvet.svg',
        };

        let lastHref = null;
        const apply = () => {
          const theme = document.documentElement.getAttribute('data-theme') || 'dawn';
          const next = ICON_BY_THEME[theme] || ICON_BY_THEME.dawn;
          if (next !== lastHref) {
            link.href = next;
            lastHref = next;
          }
        };

        apply();
        new MutationObserver(apply)
          .observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

        const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
        mq && mq.addEventListener && mq.addEventListener('change', apply);
      })();
    </script>
  </body>
</html>
