"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("json-bigint")),o=t(require("axios")),n=t(require("detect-node")),r=t(require("form-data"));require("tiny-warning");var s,a=t(require("lodash.flatmap")),i=require("@apimatic/schema");function c(t,e,o){return o(t,e)}(s=exports.Environment||(exports.Environment={})).Production="production",s.Custom="custom";const h={timeout:0,environment:exports.Environment.Production,baseUrl:"https://www.example.com",basicAuthUserName:"TODO access token",basicAuthPassword:"TODO access token"};class u extends Error{constructor(t,o){super(o);const{request:n,response:r}=t;if(this.request=n,this.statusCode=r.statusCode,this.headers=r.headers,this.body=r.body,"string"==typeof r.body&&""!==r.body){const t=e({useNativeBigInt:!0});try{this.result=t.parse(r.body)}catch(t){}}}}function l(t){return"undefined"!=typeof Blob&&(t instanceof Blob||"[object Blob]"===Object.prototype.toString.call(t))}class p extends Error{}class d{constructor(t,e){this.file=t,this.options=e,this.file=t}}function m(t){return t instanceof d}function f(t){let e;return t.options&&(e=function(t){const e={...t};return t.headers&&(e.headers={...t.headers}),e}(t.options)),new d(t.file,e)}function g(t,e,o){y(t,b(t,e),e,o)}function y(t,e,o,n){e&&delete t[e],n&&(t[o]=n)}function w(t,e,o){const n=b(t,e);n||y(t,n,e,o)}function b(t,e){e=e.toLowerCase();for(const o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e===o.toLowerCase())return o;return null}function T(t,e){const o={};for(const e of Object.getOwnPropertyNames(t))o[e.toLowerCase()]=e;for(const n of Object.getOwnPropertyNames(e)){const r=n.toLowerCase();o[r]&&delete t[o[r]],o[r]=n,t[n]=e[n]}}const v=(t,e)=>`${t}[${e}]`;function _(t,e=v){const o=[];for(const n of Object.keys(t)){const r=t[n];if(null!=r)if("string"==typeof r||"number"==typeof r||"boolean"==typeof r||"bigint"==typeof r)o.push({key:n,value:r.toString()});else if(m(r))o.push({key:n,value:f(r)});else if(Array.isArray(r))for(let t=0;t<r.length;t+=1)o.push(..._({[e(n,t)]:r[t]}));else if("object"==typeof r)for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const e=r[t];o.push(..._({[v(n,t)]:e}))}}return o}function O(t){const e=encodeURIComponent;return(t||[]).map(t=>`${e(t.key)}=${e(t.value.toString())}`).join("&")}const q={transformResponse:[]};class C{constructor({clientConfigOverrides:t,timeout:e=3e4}={}){this._timeout=e,this._axiosInstance=o.create({...q,...t})}convertHttpRequest(t){const e={method:t.method,url:t.url,responseType:"text",headers:{...t.headers}};t.auth&&(e.auth={username:t.auth.username,password:t.auth.password||""});const o=t.body;if("text"===(null==o?void 0:o.type))e.data=o.content;else if("form-data"===(null==o?void 0:o.type)&&o.content.some(t=>m(t.value))){const t=new r;for(const e of o.content)if(m(e.value)){var s;let o=e.value.file;l(o)&&null!=(s=e.value.options)&&s.contentType&&(o=new Blob([o],{type:e.value.options.contentType})),t.append(e.key,o,e.value.options)}else t.append(e.key,e.value);e.data=t,T(e.headers||{},t.getHeaders())}else if("form-data"===(null==o?void 0:o.type)||"form"===(null==o?void 0:o.type))g(e.headers||{},"content-type","application/x-www-form-urlencoded"),e.data=O(o.content);else if("stream"===(null==o?void 0:o.type)){var a;let t="application/octet-stream";l(o.content.file)&&o.content.file.type?t=o.content.file.type:null!=(a=o.content.options)&&a.contentType&&(t=o.content.options.contentType),w(e.headers||{},"content-type",t),e.data=o.content.file}else if(o&&void 0!==o.type)throw new Error(`HTTP client encountered unknown body type '${o.type}'. Could not execute HTTP request.`);return"stream"===t.responseType&&(e.responseType=n?"stream":"blob"),e.validateStatus=()=>!0,e.timeout=this._timeout,e}convertHttpResponse(t){return{body:t.data,headers:t.headers,statusCode:t.status}}async executeRequest(t,e){const n=this.convertHttpRequest(t);if(null!=e&&e.abortSignal){if(e.abortSignal.aborted)throw this.abortError();const t=o.CancelToken.source();n.cancelToken=t.token,e.abortSignal.addEventListener("abort",()=>{t.cancel()})}try{return this.convertHttpResponse(await this._axiosInstance(n))}catch(t){if(o.isCancel(t))throw this.abortError();throw t}}abortError(){return new p("The HTTP call was aborted.")}}class P{constructor(t){this.value=t}}function I(t,...e){return a(function(t,e){const o=Math.min(t.length,e.length);return Array.apply(null,new Array(o)).reduce((o,n,r)=>(o.push(t[r],e[r]),o),[]).concat((t.length>o?t:e).slice(o))}(t.map(t=>new P(t)),e),x).join("")}function x(t){let e=!1;const o=t=>e?t.toString():encodeURIComponent(t);return t instanceof P&&(t=t.value,e=!0),Array.isArray(t)?t.map(o).join("/"):[o(t)]}class A extends Error{constructor(t){const e=Object.keys(t);let o;if(0===e.length)o="One or more arguments failed validation.";else if(1===e.length&&1===t[e[0]].length)o=`Argument for '${e[0]}' failed validation.\n\n${t[e[0]][0].message}`;else{o=`The following arguments failed validation: ${e.join(", ")}.\n\n`;const n=[];for(const o of e)if(n.push(`> For argument '${o}':`),1===t[o].length)n.push(t[o][0].message);else for(let e=0;e<t[o].length;e++)n.push(`>> Issue #${e+1}\n\n${t[o][e].message}`);o+=n.join("\n\n")}super(o),this.errors=t}}class E extends Error{constructor(t,e){let o="The response did not match the response schema.";o+=1===e.length?"\n\n"+e[0].message:e.map((t,e)=>`\n\n> Issue #${e+1}\n\n${t.message}`).join(""),super(o),this.request=t.request,this.statusCode=t.statusCode,this.headers=t.headers,this.body=t.body,this.errors=e}}function R(t){const e={},o={};for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n],s=i.validateAndUnmap(r[0],r[1]);s.errors?e[n]=s.errors:o[n]=s.result}if(Object.keys(e).length>0)throw new A(e);return o}const j=e({useNativeBigInt:!0});class ${constructor(t,e,o,n,r,s){this._httpClient=t,this._baseUrlProvider=e,this._apiErrorFactory=o,this._authenticationProvider=n,this._httpMethod=r,this._path=s,this._headers={},this._query=[],this._interceptors=[],this._validateResponse=!0,this._addResponseValidator(),this._addAuthentication(),this.prepareArgs=R.bind(this)}authenticate(t){this._authParams=t}deprecated(t,e){}appendTemplatePath(t,...e){const o=I(t,...e);this.appendPath(o)}method(t){this._httpMethod=t}baseUrl(t){this._baseUrlArg=t}appendPath(t){this._path=this._path?k(this._path,t):t}acceptJson(){this._accept="application/json"}accept(t){this._accept=t}contentType(t){this._contentType=t}header(t,e){void 0!==e&&g(this._headers,t,e.toString())}headers(t){T(this._headers,t)}query(t,e){if(null==t)return;const o=O(_("string"==typeof t?{[t]:e}:t));o&&this._query.push(o)}text(t){this._body=t,this._setContentTypeIfNotSet("text/plain; charset=utf-8")}json(t){this._body=j.stringify(t),this._setContentTypeIfNotSet("application/json")}xml(t,e,o,n){const r=i.validateAndUnmapXml(e,n);if(r.errors)throw new A({[t]:r.errors});this._body=function(t,e){throw new Error("XML serialization is not available.")}(),this._setContentTypeIfNotSet("application/xml")}stream(t){this._stream=t}form(t){this._form=_(t).filter(t=>!m(t.value))}formData(t){this._formData=_(t)}toRequest(){const t={method:this._httpMethod,url:k(this._baseUrlProvider(this._baseUrlArg),this._path)};if(this._query.length>0){const e=this._query.join("&");t.url+=(-1===t.url.indexOf("?")?"?":"&")+e}t.url=function(t){const e=t.match(/^https?:\/\/[^/]+/);if(null===e)throw new Error("Invalid URL format: "+t);const o=e[0];return o+t.substring(o.length).replace(/\/\/+/g,"/")}(t.url);const e={...this._headers};return this._accept&&g(e,"accept",this._accept),this._contentType&&g(e,"content-type",this._contentType),g(e,"content-length"),t.headers=e,void 0!==this._body?t.body={type:"text",content:this._body}:void 0!==this._form?t.body={type:"form",content:this._form}:void 0!==this._formData?t.body={type:"form-data",content:this._formData}:void 0!==this._stream&&(t.body={type:"stream",content:this._stream}),t}intercept(t){this._interceptors.push(t)}interceptRequest(t){this.intercept((e,o,n)=>n(t(e),o))}interceptResponse(t){this.intercept(async(e,o,n)=>t(await n(e,o)))}defaultToError(t){this._apiErrorFactory=t}validateResponse(t){this._validateResponse=t}throwOn(t,e,...o){this.interceptResponse(n=>{const{response:r}=n;if("number"==typeof t&&r.statusCode===t||"number"!=typeof t&&r.statusCode>=t[0]&&r.statusCode<=t[1])throw new e(n,...o);return n})}async call(t){const e=function(t,e){let o=e;for(let e=t.length-1;e>=0;e--){const n=t[e],r=o;o=(t,e)=>n(t,e,r)}return o}(this._interceptors,async(t,e)=>({request:t,response:await this._httpClient(t,e)})),{request:o,response:n}=await e(this.toRequest(),t);return{...n,request:o,result:void 0}}async callAsText(t){const e=await this.call(t);if("string"!=typeof e.body)throw new Error("Could not parse body as string.");return{...e,result:e.body}}async callAsOptionalText(t){const e=await this.call(t);return"string"!=typeof e.body?{...e,result:void 0}:{...e,result:e.body}}async callAsStream(t){this.interceptRequest(t=>({...t,responseType:"stream"}));const e=await this.call(t);return{...e,result:S(e.body)}}async callAsJson(t,e){this.interceptRequest(t=>{const e={...t.headers};return w(e,"accept","application/json"),{...t,headers:e}});const o=await this.call(e);if(""===o.body)throw new Error("Could not parse body as JSON. The response body is empty.");if("string"!=typeof o.body)throw new Error("Could not parse body as JSON. The response body is not a string.");let n;try{n=j.parse(o.body)}catch(t){throw new Error("Could not parse body as JSON.\n\n"+t.message)}const r=i.validateAndMap(n,t);if(r.errors)throw new E(o,r.errors);return{...o,result:r.result}}async callAsXml(t,e,o){this.interceptRequest(t=>{const e={...t.headers};return w(e,"accept","application/xml"),{...t,headers:e}});const n=await this.call(o);if(""===n.body)throw new Error("Could not parse body as XML. The response body is empty.");if("string"!=typeof n.body)throw new Error("Could not parse body as XML. The response body is not a string.");let r;try{r=await async function(t,e){throw new Error("XML deserialization is not available.")}()}catch(t){throw new Error("Could not parse body as XML.\n\n"+t.message)}const s=i.validateAndMapXml(r,e);if(s.errors)throw new E(n,s.errors);return{...n,result:s.result}}_setContentTypeIfNotSet(t){this._contentType||w(this._headers,"content-type",t)}_addResponseValidator(){this.interceptResponse(t=>{const{response:e}=t;if(this._validateResponse&&(e.statusCode<200||e.statusCode>=300))throw new this._apiErrorFactory(t,`Response status code was not ok: ${e.statusCode}.`);return t})}_addAuthentication(){this.intercept((...t)=>this._authenticationProvider(this._authParams)(...t))}}function k(t,e){return e&&""!==e?"/"===t[t.length-1]&&"/"===e[0]?t+e.substr(1):"/"===t[t.length-1]||"/"===e[0]?t+e:`${t}/${e}`:t}function S(t){if("string"!=typeof t)return t;if(n){const e=new(require("stream").Readable);return e._read=()=>{},e.push(t),e.push(null),e}return new Blob([t])}class M{constructor(t){var e,o,n,r,s;this._config={...h,...t},this._requestBuilderFactory=(e=t=>function(t="MessagingDefault",e){if(e.environment===exports.Environment.Production&&"MessagingDefault"===t)return"https://messaging.bandwidth.com/api/v2";if(e.environment===exports.Environment.Custom&&"MessagingDefault"===t)return I`${new P(e.baseUrl)}`;throw new Error("Could not get Base URL. Invalid environment or server.")}(t,this._config),o=(({basicAuthUserName:t,basicAuthPassword:e})=>o=>o?(o,n,r)=>(o.auth={username:t,password:e},r(o,n)):c)(this._config),n=new C({timeout:this._config.timeout,clientConfigOverrides:this._config.unstable_httpClientOptions}),r=[D,N,U],function(t,...e){return(...o)=>{const n=t(...o);return e.forEach(t=>t(n)),n}}(function(t,e,o,n){return(r,s)=>new $(t,e,o,n,r,s)}((s=n,async(t,e)=>await s.executeRequest(t,e)),e,u,o),...r))}getRequestBuilderFactory(){return this._requestBuilderFactory}withConfiguration(t){return new M({...this._config,...t})}}function D(t){t.defaultToError(u)}function N(t){t.header("user-agent","node-messaging")}function U(t){t.authenticate(!0)}class L extends u{}const F=i.object({id:["id",i.optional(i.string())],owner:["owner",i.optional(i.string())],applicationId:["applicationId",i.optional(i.string())],time:["time",i.optional(i.string())],segmentCount:["segmentCount",i.optional(i.number())],direction:["direction",i.optional(i.string())],to:["to",i.optional(i.array(i.string()))],from:["from",i.optional(i.string())],media:["media",i.optional(i.array(i.string()))],text:["text",i.optional(i.string())],tag:["tag",i.optional(i.string())],priority:["priority",i.optional(i.string())]}),B=i.object({messageId:["messageId",i.optional(i.string())],accountId:["accountId",i.optional(i.string())],sourceTn:["sourceTn",i.optional(i.string())],destinationTn:["destinationTn",i.optional(i.string())],messageStatus:["messageStatus",i.optional(i.string())],messageDirection:["messageDirection",i.optional(i.string())],messageType:["messageType",i.optional(i.string())],segmentCount:["segmentCount",i.optional(i.number())],errorCode:["errorCode",i.optional(i.number())],receiveTime:["receiveTime",i.optional(i.string())],carrierName:["carrierName",i.nullable(i.optional(i.string()))]}),H=i.object({prevPage:["prevPage",i.optional(i.string())],nextPage:["nextPage",i.optional(i.string())],prevPageToken:["prevPageToken",i.optional(i.string())],nextPageToken:["nextPageToken",i.optional(i.string())]}),J=i.object({totalCount:["totalCount",i.optional(i.number())],pageInfo:["pageInfo",i.optional(i.lazy(()=>H))],messages:["messages",i.optional(i.array(i.lazy(()=>B)))]}),X=i.object({content:["content",i.optional(i.string())],contentLength:["contentLength",i.optional(i.number())],mediaName:["mediaName",i.optional(i.string())]});var z;(z=exports.PriorityEnum||(exports.PriorityEnum={})).Default="default",z.High="high";const G=i.stringEnum(exports.PriorityEnum),V=i.object({applicationId:["applicationId",i.string()],to:["to",i.array(i.string())],from:["from",i.string()],text:["text",i.optional(i.string())],media:["media",i.optional(i.array(i.string()))],tag:["tag",i.optional(i.string())],priority:["priority",i.optional(G)]});exports.AbortError=p,exports.ApiController=class extends class{constructor(t){this.createRequest=t.getRequestBuilderFactory()}}{async listMedia(t,e,o){const n=this.createRequest("GET"),r=n.prepareArgs({accountId:[t,i.string()],continuationToken:[e,i.optional(i.string())]});return n.header("Continuation-Token",r.continuationToken),n.appendTemplatePath`/users/${r.accountId}/media`,n.throwOn(400,L,"400 Request is malformed or invalid"),n.throwOn(401,L,"401 The specified user does not have access to the account"),n.throwOn(403,L,"403 The user does not have access to this API"),n.throwOn(404,L,"404 Path not found"),n.throwOn(415,L,"415 The content-type of the request is incorrect"),n.throwOn(429,L,"429 The rate limit has been reached"),n.callAsJson(i.array(X),o)}async getMedia(t,e,o){const n=this.createRequest("GET"),r=n.prepareArgs({accountId:[t,i.string()],mediaId:[e,i.string()]});return n.appendTemplatePath`/users/${r.accountId}/media/${r.mediaId}`,n.throwOn(400,L,"400 Request is malformed or invalid"),n.throwOn(401,L,"401 The specified user does not have access to the account"),n.throwOn(403,L,"403 The user does not have access to this API"),n.throwOn(404,L,"404 Path not found"),n.throwOn(415,L,"415 The content-type of the request is incorrect"),n.throwOn(429,L,"429 The rate limit has been reached"),n.callAsStream(o)}async uploadMedia(t,e,o,n,r,s){const a=this.createRequest("PUT"),c=a.prepareArgs({accountId:[t,i.string()],mediaId:[e,i.string()],contentType:[n,i.optional(i.string())],cacheControl:[r,i.optional(i.string())]});return a.header("Content-Type",c.contentType),a.header("Cache-Control",c.cacheControl),a.stream(o),a.appendTemplatePath`/users/${c.accountId}/media/${c.mediaId}`,a.throwOn(400,L,"400 Request is malformed or invalid"),a.throwOn(401,L,"401 The specified user does not have access to the account"),a.throwOn(403,L,"403 The user does not have access to this API"),a.throwOn(404,L,"404 Path not found"),a.throwOn(415,L,"415 The content-type of the request is incorrect"),a.throwOn(429,L,"429 The rate limit has been reached"),a.call(s)}async deleteMedia(t,e,o){const n=this.createRequest("DELETE"),r=n.prepareArgs({accountId:[t,i.string()],mediaId:[e,i.string()]});return n.appendTemplatePath`/users/${r.accountId}/media/${r.mediaId}`,n.throwOn(400,L,"400 Request is malformed or invalid"),n.throwOn(401,L,"401 The specified user does not have access to the account"),n.throwOn(403,L,"403 The user does not have access to this API"),n.throwOn(404,L,"404 Path not found"),n.throwOn(415,L,"415 The content-type of the request is incorrect"),n.throwOn(429,L,"429 The rate limit has been reached"),n.call(o)}async getMessages(t,e,o,n,r,s,a,c,h,u,l){const p=this.createRequest("GET"),d=p.prepareArgs({accountId:[t,i.string()],messageId:[e,i.optional(i.string())],sourceTn:[o,i.optional(i.string())],destinationTn:[n,i.optional(i.string())],messageStatus:[r,i.optional(i.string())],errorCode:[s,i.optional(i.number())],fromDateTime:[a,i.optional(i.string())],toDateTime:[c,i.optional(i.string())],pageToken:[h,i.optional(i.string())],limit:[u,i.optional(i.number())]});return p.query("messageId",d.messageId),p.query("sourceTn",d.sourceTn),p.query("destinationTn",d.destinationTn),p.query("messageStatus",d.messageStatus),p.query("errorCode",d.errorCode),p.query("fromDateTime",d.fromDateTime),p.query("toDateTime",d.toDateTime),p.query("pageToken",d.pageToken),p.query("limit",d.limit),p.appendTemplatePath`/users/${d.accountId}/messages`,p.throwOn(400,L,"400 Request is malformed or invalid"),p.throwOn(401,L,"401 The specified user does not have access to the account"),p.throwOn(403,L,"403 The user does not have access to this API"),p.throwOn(404,L,"404 Path not found"),p.throwOn(415,L,"415 The content-type of the request is incorrect"),p.throwOn(429,L,"429 The rate limit has been reached"),p.callAsJson(J,l)}async createMessage(t,e,o){const n=this.createRequest("POST"),r=n.prepareArgs({accountId:[t,i.string()],body:[e,V]});return n.json(r.body),n.appendTemplatePath`/users/${r.accountId}/messages`,n.throwOn(400,L,"400 Request is malformed or invalid"),n.throwOn(401,L,"401 The specified user does not have access to the account"),n.throwOn(403,L,"403 The user does not have access to this API"),n.throwOn(404,L,"404 Path not found"),n.throwOn(415,L,"415 The content-type of the request is incorrect"),n.throwOn(429,L,"429 The rate limit has been reached"),n.callAsJson(F,o)}},exports.ApiError=u,exports.ArgumentsValidationError=A,exports.Client=M,exports.DEFAULT_CONFIGURATION=h,exports.FileWrapper=d,exports.ResponseValidationError=E,exports.cloneFileWrapper=f,exports.isFileWrapper=m;
//# sourceMappingURL=messaging.cjs.production.min.js.map
